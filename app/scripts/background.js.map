{"version":3,"sources":["../scripts.babel/background.js"],"names":[],"mappings":"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","file":"background.js","sourcesContent":["'use strict';\n\n/*\nlet startTime = new Date.now();\nlet currentMillis = today.getMilliseconds()\n*/\n\nconst TIME_DECR = 1000;\nconst AMBER_PERIOD = 120000; // 2 min\nconst RED_PERIOD = 60000; // 1 min\nconst COLORS = {\n  GREEN: '#00CC00', AMBER: '#FFC200', RED: '#FF0000'\n};\n\nlet currentTab;\nlet countdownID;\nlet bookmarkData;\nlet tabRemovedByExtension;\n\n\nfunction msToTime(ms) {\n  // to seconds\n  let secs = Math.floor( ms / 1000 );\n  let mins = Math.floor( secs / 60 );\n  let remainingSecs = (secs % 60) + '';\n  remainingSecs = remainingSecs.length === 2 ? remainingSecs : '0' + remainingSecs;\n\n  return mins + ':' + remainingSecs;\n}\n\nfunction openBookmark() {\n\n  let timePeriod = bookmarkData.millis;\n  let initialColor = timePeriod > AMBER_PERIOD ? 'GREEN' \n    : timePeriod > RED_PERIOD ? 'AMBER' : 'RED';\n\n  chrome.browserAction.setBadgeBackgroundColor({color: COLORS[initialColor] });\n\n  if ( timePeriod > AMBER_PERIOD ) {\n    setTimeout(function() {\n      chrome.browserAction.setBadgeBackgroundColor({color: COLORS.AMBER});\n    }, timePeriod - AMBER_PERIOD);\n  }\n  if ( timePeriod > RED_PERIOD ) {\n    setTimeout(function() {\n      chrome.browserAction.setBadgeBackgroundColor({color: COLORS.RED});\n    }, timePeriod - RED_PERIOD);\n  }\n\n  chrome.tabs.create({url: bookmarkData.redirect}, tab => {\n    console.log(tab);\n    currentTab = tab;\n  });\n\n  // Initialise timer\n  countdownID = setInterval(function() {\n\n    timePeriod -= TIME_DECR;\n    chrome.browserAction.setBadgeText({ text: msToTime(timePeriod) });\n\n    if (timePeriod === 0)\n    {\n      chrome.tabs.remove(currentTab.id);\n      clearInterval(countdownID);\n    }\n\n  }, TIME_DECR );\n}\n\n\n\nchrome.runtime.onInstalled.addListener(details => {\n  console.log('previousVersion', details.previousVersion);\n});\n\nchrome.tabs.onRemoved.addListener(tabID => {\n\n  if (tabID === currentTab.id) {\n\n    clearInterval(countdownID);\n    chrome.browserAction.setBadgeText({ text: '' });\n    currentTab = undefined;\n\n    if (tabRemovedByExtension) {\n      openBookmark();\n      tabRemovedByExtension = false;\n    }\n  }\n});\n\nchrome.runtime.onMessage.addListener(request => { /*, sender*/\n\n  bookmarkData = request;\n\n  if (typeof currentTab === typeof {})\n  {\n    tabRemovedByExtension = true;\n    chrome.tabs.remove(currentTab.id); // destroy previous roulette tab, callback will openBookmark when ready\n  }\n  else\n  {\n    openBookmark();\n  }\n});\n\n"]}